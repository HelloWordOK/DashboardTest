<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.nokia.charts.dao.TestingDao">
	<cache type="org.mybatis.caches.ehcache.LoggingEhcache"/>
	<resultMap type="com.nokia.charts.entity.testing.Performance" id="resultPerformance">
		<id column="id" property="id" />
		<result column="project" property="project" />
		<result column="environment" property="environment" />
		<result column="function_type" property="functionType" />
		<result column="version" property="version" />
		<result column="test_date" property="testDate" />
		<result column="samples" property="samples" />
		<result column="average" property="average" />
		<result column="median" property="median" />
		<result column="error" property="error" />
		<result column="ninety_pec_line" property="ninetyPecLine" />
		<result column="min" property="min" />
		<result column="max" property="max" />
		<result column="throughput" property="throughput" />
		<result column="kb_sec" property="kbSec" />
		<result column="result" property="result" />
		<result column="ishistory" property="isHistory" />
	</resultMap>

	<resultMap type="com.nokia.charts.entity.testing.FunctionalSummary" id="resultFunctionalSummary">
		<id column="id" property="id" />
		<result column="project" property="project" />
		<result column="environment" property="environment" />
		<result column="module" property="module" />
		<result column="version" property="version" />
		<result column="cycle" property="cycle" />
		<result column="test_date" property="testDate" />
		<result column="test_case" property="testCase" />
		<result column="time" property="time" />
		<result column="assertions" property="assertions" />
		<result column="pass" property="pass" />
		<result column="fail" property="fail" />
		<result column="error" property="error" />
		<result column="skip" property="skip" />
		<result column="incomplete" property="incomplete" />
		<result column="risk" property="risk" />
		<result column="pass_rate" property="passRate" />
		<result column="final_result" property="finalResult" />
	</resultMap>
	
	<resultMap type="com.nokia.charts.entity.testing.FunctionalModule" id="resultFunctionalModule">
		<id column="id" property="id" />
		<result column="project" property="project" />
		<result column="environment" property="environment" />
		<result column="module" property="module" />
		<result column="version" property="version" />
		<result column="cycle" property="cycle" />
		<result column="module_test_case" property="moduleTestCase" />
		<result column="pass" property="pass" />
		<result column="fail" property="fail" />
		<result column="error" property="error" />
		<result column="skip" property="skip" />
		<result column="incomplete" property="incomplete" />
		<result column="risk" property="risk" />
		<result column="module_pass_rate" property="modulePassRate" />
		<result column="module_result" property="moduleResult" />
	</resultMap>

	<resultMap type="com.nokia.charts.entity.testing.FunctionalFailLog" id="resultFunctionalFailLog">
		<id column="id" property="id" />
		<result column="project" property="project" />
		<result column="environment" property="environment" />
		<result column="module" property="module" />
		<result column="version" property="version" />
		<result column="cycle" property="cycle" />
		<result column="function" property="function" />
		<result column="case_name" property="caseName" />
		<result column="screenshot" property="screenshot" />
		<result column="log" property="log" />
		<result column="case_result" property="caseResult" />
	</resultMap>

	<select id="selectProjectList" resultType="string">
	    SELECT DISTINCT
			project
		FROM
			test_performance
	</select>
	
	<select id="selectFunctionTypeByProject" parameterType="string" resultType="string">
	    SELECT DISTINCT
			function_type
		FROM
			test_performance
		WHERE
			project = #{project}
	</select>

	<select id="selectFunctionTypeByProjectAndEnvironment" parameterType="string" resultType="string">
	    SELECT DISTINCT
			function_type
		FROM
			test_performance
		WHERE
			project = #{0}
			AND environment = #{1}
	</select>

<select id="selectVersionByProjectAndEnvironment" parameterType="string" resultType="string">
	    SELECT DISTINCT
			version
		FROM
			test_performance
		WHERE
			project = #{0}
			AND environment = #{1}
	</select>

	<select id="selectVersionByProject" parameterType="string" resultType="string">
	    SELECT DISTINCT
			version
		FROM
			test_performance
		WHERE
			project = #{project}
	</select>

	<select id="selectPerformanceList" parameterType="map"
		resultMap="resultPerformance">
		SELECT
			*
		FROM (SELECT
			*
		FROM
			test_performance
		WHERE
			project = #{project} 
			AND environment = #{environment} 
			AND function_type = #{functionType} 
			AND ishistory='1'
		ORDER BY
			id DESC 
		LIMIT 0,6) temp
		ORDER BY
			temp.test_date
	</select>
	
	<select id="selectPerformanceBaseLine" parameterType="map"
		resultType="com.nokia.charts.entity.testing.PerformanceBaseLine">
		SELECT
			rt_baseline rtBaseLine,
			rt_range rtRange,
			throughput_baseline throughputBaseLine,
			throughput_range throughputRange,
			error_baseline errorBaseLine
		FROM
			test_performance_baseline
		WHERE
			project = #{project} 
			AND environment = #{environment}
			AND function_type = #{functionType}
	</select>
	<select id="selectFunctionTestProject" resultType="string">
	    SELECT DISTINCT
			project
		FROM
			test_functional_summary
	</select>
	
	<select id="selectFunctionTestVersion" parameterType="string" resultType="string">
	   SELECT DISTINCT
			version
		FROM
			test_functional_summary
		WHERE
			project = #{project}
	</select>
	
	<select id="selectFunctionTestCycle" parameterType="map" resultType="string">
	   SELECT DISTINCT
			cycle
		FROM
			test_functional_summary
		WHERE
			project = #{project}
			AND version = #{testVersion}
			AND environment = #{environment}
	</select>
	
	<select id="selectFunctionalSummary" parameterType="map"
		resultMap="resultFunctionalSummary">
		SELECT
			*
		FROM
			test_functional_summary
		WHERE
			project = #{project} 
		AND environment = #{environment} 
		AND version = #{testVersion} 
		AND cycle = #{testCycle}
	</select>
	
	<select id="selectFunctionalModule" parameterType="map"
		resultMap="resultFunctionalModule">
		SELECT
			*
		FROM
			test_functional_module
		WHERE
			project = #{project} 
		AND environment = #{environment} 
		AND version = #{testVersion} 
		AND cycle = #{testCycle}
	</select>
	
	<select id="selectFunctionalFailLog" parameterType="map"
		resultMap="resultFunctionalFailLog">
		SELECT
			*
		FROM
			test_functional_fail_log
		WHERE
			project = #{project} 
		AND environment = #{environment} 
		AND version = #{testVersion} 
		AND cycle = #{testCycle}
	</select>

	<insert id="addBaseline" parameterType="com.nokia.charts.dto.BaselineDto">
		INSERT INTO 
			test_performance_baseline
			(project,
			environment,
			function_type,
			rt_baseline,
			rt_range,
			throughput_baseline,
			throughput_range,
			error_baseline)
		VALUES
			(#{project},
			#{environment},
			#{functionType},
			#{rtBaseline},
			#{rtRange},
			#{tBaseline},
			#{tRange},
			#{eBaseline})
		ON DUPLICATE KEY UPDATE
			rt_baseline = values(rt_baseline),
			rt_range = values(rt_range),
			throughput_baseline = values(throughput_baseline),
			throughput_range = values(throughput_range),
			error_baseline = values(error_baseline)
	</insert>

	<select id="selectPerformanceListByVersion" parameterType="map"
		resultMap="resultPerformance">
		SELECT
			*
		FROM
			test_performance
		WHERE
			project = #{project} 
			AND environment = #{environment} 
			AND version = #{version} 
			AND ishistory='1'
		ORDER BY
			id ASC
	</select>

	<select id="selectPerformanceBaseLineList" parameterType="map"
		resultType="com.nokia.charts.entity.testing.PerformanceBaseLine">
		SELECT
			function_type functionType,
			rt_baseline rtBaseLine,
			rt_range rtRange,
			throughput_baseline throughputBaseLine,
			throughput_range throughputRange,
			error_baseline errorBaseLine
		FROM
			test_performance_baseline
		WHERE
			project = #{project} 
			AND environment = #{environment}
	</select>
</mapper>